# üìÑ File Formats

## Overview

v-and-r generates and maintains several file formats for release management and documentation. This guide covers the structure and purpose of each file type.

## version.json

Generated by `--release-info` and `--release-prepare` commands.

### Structure

```json
{
  "version": "v1.2.3",
  "timestamp": "2023-01-01T10:00:00",
  "commit_hash": "abc1234",
  "previous_version": "v1.2.2",
  "commits": [
    {
      "hash": "abc1234567",
      "message": "feat: add new feature",
      "author": "Developer Name",
      "date": "2023-01-01T10:00:00"
    }
  ]
}
```

### Fields

- **version**: Current version string
- **timestamp**: ISO format timestamp of release generation
- **commit_hash**: Short hash of current commit
- **previous_version**: Previous version tag (if available)
- **commits**: Array of commits since previous version

### Usage

```bash
# Generate version.json
python v-and-r.py --release-info

# Include in release preparation
python v-and-r.py --release-prepare
```

## CHANGELOG.md

Automatically updated by `--release-prepare` command following the [Keep a Changelog](https://keepachangelog.com/) format.

### Structure

```markdown
# Changelog
All notable changes to this project will be documented here.

## [Unreleased]

## [v1.2.3] - 2023-01-01
### Added
- New feature implementation

### Fixed
- Bug fix for issue #123

### Commits
abc1234 feat: add new feature                                    Developer Name    2023-01-01 10:00 +0000
def5678 fix: resolve issue #123                                  Developer Name    2023-01-01 11:00 +0000

## [v1.2.2] - 2022-12-15
### Fixed
- Critical security patch

[Unreleased]: https://github.com/org/repo/compare/v1.2.3...HEAD
[v1.2.3]: https://github.com/org/repo/compare/v1.2.2...v1.2.3
[v1.2.2]: https://github.com/org/repo/compare/v1.2.1...v1.2.2
```

### Sections

- **Unreleased**: Placeholder for future changes
- **Version entries**: Each release with date
- **Categories**: Added, Changed, Deprecated, Removed, Fixed, Security
- **Commits**: Detailed commit list with metadata
- **Links**: Compare links for GitHub/GitLab integration

### Commit Categorization

The tool automatically categorizes commits based on conventional commit messages:

- **feat:** ‚Üí Added
- **fix:** ‚Üí Fixed
- **docs:** ‚Üí Changed (documentation)
- **style:** ‚Üí Changed
- **refactor:** ‚Üí Changed
- **test:** ‚Üí Changed
- **chore:** ‚Üí Changed
- **BREAKING CHANGE:** ‚Üí Changed (with note)

## RELEASES.md

Summary of releases updated by `--release-prepare` command.

### Structure

```markdown
# Releases

## v1.2.3 - 2023-01-01

**2 commits** from **1 contributors**

Changes since v1.2.2:
- 1 new features, 1 bug fixes

**Contributors:** Developer Name
**Commit Hash:** `abc1234`

### Highlights
- New feature implementation
- Bug fix for issue #123

### All Changes
- feat: add new feature (abc1234)
- fix: resolve issue #123 (def5678)

---

## v1.2.2 - 2022-12-15

**1 commits** from **1 contributors**

Changes since v1.2.1:
- 1 bug fixes

**Contributors:** Developer Name
**Commit Hash:** `xyz9876`

### Highlights
- Critical security patch
```

### Sections

- **Release header**: Version and date
- **Statistics**: Commit and contributor counts
- **Summary**: Change type breakdown
- **Metadata**: Contributors and commit hash
- **Highlights**: Key changes
- **All Changes**: Complete commit list

## Configuration Files

### VERSION_FILES Configuration

Embedded in the main script, defines file patterns and version matching rules.

```python
VERSION_FILES = [
    {
        'file': 'README.md',
        'pattern': re.compile(r'- Version (v\d+\.\d+\.\d+)'),
        'template': '- Version {version}',
    },
    {
        'file': 'src/*.py',
        'pattern': re.compile(r'version = "(v\d+\.\d+\.\d+)"'),
        'template': 'version = "{version}"',
    },
]
```

### Git Integration Files

The tool reads and interprets standard git files:

- **.git/**: Git repository metadata
- **git tags**: Version tags for release tracking
- **git log**: Commit history for release notes

## File Generation Workflow

### Automatic Generation

```bash
# Single command generates all files
python v-and-r.py --release-prepare
```

**Generated/Updated:**
1. version.json (complete metadata)
2. CHANGELOG.md (new version entry)
3. RELEASES.md (new release summary)

### Manual Generation

```bash
# Generate only version.json
python v-and-r.py --release-info

# Update version numbers in source files
python v-and-r.py --patch

# Create git tag
python v-and-r.py --release-deploy
```

## Customization

### CHANGELOG.md Customization

The tool generates standard changelog entries, but you can manually edit:

```markdown
## [v1.2.3] - 2023-01-01
### Added
- New authentication system with OAuth2 support
- User dashboard with real-time analytics

### Changed
- Improved API response times by 40%
- Updated UI components for better accessibility

### Fixed
- Fixed memory leak in background processing
- Resolved issue with file upload validation

### Security
- Updated dependencies to address CVE-2023-1234
```

### RELEASES.md Customization

Add custom sections after generation:

```markdown
## v1.2.3 - 2023-01-01

### üéâ Major Features
- Complete authentication overhaul
- New dashboard interface

### üêõ Bug Fixes
- Memory leak resolution
- File upload improvements

### üìà Performance
- 40% faster API responses
- Reduced memory usage

### üîí Security
- Dependency updates
- Enhanced validation
```

## Integration with External Tools

### GitHub/GitLab Integration

The generated files integrate well with repository hosting:

- **CHANGELOG.md**: Displayed in repository root
- **RELEASES.md**: Can be used for release descriptions
- **version.json**: Machine-readable for CI/CD

### CI/CD Integration

```yaml
# GitHub Actions example
- name: Generate Release Files
  run: python v-and-r.py --release-prepare

- name: Create Release
  uses: actions/create-release@v1
  with:
    tag_name: ${{ env.VERSION }}
    release_name: Release ${{ env.VERSION }}
    body_path: RELEASES.md
```

### Package Manager Integration

```json
// package.json - automatically updated
{
  "name": "my-package",
  "version": "1.2.3",
  "description": "My awesome package"
}
```

```python
# setup.py - automatically updated
setup(
    name="my-package",
    version="1.2.3",
    description="My awesome package"
)
```